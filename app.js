(()=>{"use strict";var e={165:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(147)),n=r(187);console.log("        _   _         _           _              _          \n       /\\_\\/\\_\\ _    / /\\        / /\\          /\\ \\         \n      / / / / //\\_\\ / /  \\      / /  \\        /  \\ \\        \n     /\\ \\/ \\ \\/ / // / /\\ \\__  / / /\\ \\__    / /\\ \\ \\       \n    /  \\____\\__/ // / /\\ \\___\\/ / /\\ \\___\\  / / /\\ \\ \\      \n   / /\\/________/ \\ \\ \\ \\/___/\\ \\ \\ \\/___/  \\/_//_\\ \\ \\     \n  / / /\\/_// / /   \\ \\ \\       \\ \\ \\          __\\___ \\ \\    \n / / /    / / /_    \\ \\ \\  _    \\ \\ \\        / /\\   \\ \\ \\   \n/ / /    / / //_/\\__/ / / /_/\\__/ / /       / /_/____\\ \\ \\  \n\\/_/    / / / \\ \\/___/ /  \\ \\/___/ /       /__________\\ \\ \\ \n        \\/_/   \\_____\\/    \\_____\\/        _____________\\/ \n"),console.log("[MSS 3] Powered By SkyWorldStudio"),console.log(`[MSS 3] Version: ${(0,n.getInfo)("version")}`),console.log("[MSS 3] Init Starting");const o="public";a.default.existsSync(o)||(console.log('[MSS 3] Warning! This is the developer version! For users, please refer to wiki. For developers, you can create a "public" folder in the root directory'),process.exit(0));const i=r(326);console.log("[MSS 3] Loading program settings"),(0,i.initUserConfig)();const u=r(95);console.log("[MSS 3] "+(0,u.getMessage)("app.initLang"));const l=s(r(873));l.default.log((0,u.getMessage)("app.initLogger")),l.default.log((0,u.getMessage)("app.initOver"));const d=s(r(37)),f=s(r(406)),c=s(r(4)),_=s(r(511)),p=s(r(97)),g=s(r(685)),y=r(828),h=s(r(868)),S=s(r(33)),m=new f.default;m.keys=[(0,y.v4)()],m.use((0,_.default)({key:(0,y.v4)(),maxAge:864e5,overwrite:!0,httpOnly:!0,signed:!0,rolling:!1,renew:!1,secure:!1},m)),m.use((0,c.default)({multipart:!0,parsedMethods:["POST","PUT","DELETE","GET"]})),m.use((0,p.default)(o)),m.use((async(e,t)=>{l.default.info(`[Req] Method: ${e.method} URL: ${e.URL.href}`),l.default.info(`[Req] IP: ${e.ip} User: ${e.session.userName} UUID: ${e.session.uuid}`),await t()})),m.use(S.default),m.use(h.default.routes()).use(h.default.allowedMethods());const w=g.default.createServer(m.callback()),b=i.userConfig.port,M=i.userConfig.address;if(w.listen(b,M),l.default.info("=----------------------------------------="),l.default.info((0,u.getMessage)("app.Started")),l.default.info((0,u.getMessage)("app.StartedTip")),l.default.info((0,u.getMessage)("app.StartedHost",{port:b})),l.default.info("=----------------------------------------="),"win32"==d.default.platform())try{open(`http://localhost:${b}/`)}catch(e){l.default.warn((0,u.getMessage)("app.Win32WebError"))}},68:function(e,t,r){var s,a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(r(147)),o=a(r(17));t.default=new((s=class e{constructor(){n.default.existsSync(e.CONFIG_PATH)||n.default.mkdirSync(e.CONFIG_PATH)}create(t,r,s){const a=o.default.join(e.CONFIG_PATH,t);if(n.default.existsSync(a)||n.default.mkdirSync(a),!this.checkFileName(r))throw new Error("Illegal profile name!");const i=JSON.stringify(s),u=o.default.join(a,r+".json");n.default.writeFileSync(u,i,{encoding:"utf-8"})}get(t,r,s){const a=o.default.join(e.CONFIG_PATH,t);if(n.default.existsSync(a)||n.default.mkdirSync(a),!this.checkFileName(s))throw new Error("Illegal profile name!");const i=o.default.join(a,s+".json");if(!n.default.existsSync(i))return null;const u=n.default.readFileSync(i,{encoding:"utf-8"}),l=JSON.parse(u);return this.JSONToClass(new r,l)}gets(t,r){const s=o.default.join(e.CONFIG_PATH,t);n.default.existsSync(s)||n.default.mkdirSync(s);const a=n.default.readdirSync(s),i=new Array;return a.forEach((e=>{const t=n.default.readFileSync(o.default.join(s,e),{encoding:"utf-8"}),a=JSON.parse(t);i.push(this.JSONToClass(r,a))})),i}set(t,r,s){const a=o.default.join(e.CONFIG_PATH,t);if(n.default.existsSync(a)||n.default.mkdirSync(a),!this.checkFileName(r))throw new Error("Illegal profile name!");n.default.writeFileSync(o.default.join(a,r+".json"),JSON.stringify(s),{encoding:"utf-8"})}JSONToClass(e,t){for(const r of Object.keys(e)){const s=t[r];void 0!==s&&(s instanceof Object&&"object"==typeof s?this.JSONToClass(e[r],s):e[r]=s)}return e}checkFileName(e){const t=["\\","/",".."];for(const r of t)if(e.includes(r))return!1;return!0}}).CONFIG_PATH=o.default.join(process.cwd(),"data"),s)},873:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(94));a.default.configure({appenders:{console:{type:"stdout",layout:{type:"pattern",pattern:"[%d{MM/dd hh:mm:ss}] [%[%p%]] %m"}},logFile:{type:"file",filename:"logs/last.log",layout:{type:"pattern",pattern:"%d %p %m"}}},categories:{default:{appenders:["console","logFile"],level:"info"}}});const n=a.default.getLogger("default");t.default=n},187:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getInfo=void 0;const a=s(r(147)),n="package.json";t.getInfo=function(e){if(a.default.existsSync(n)){const t=JSON.parse(a.default.readFileSync(n,{encoding:"utf-8"}));if(t[e])return t[e]}}},95:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=t.getMessage=void 0;const a=s(r(805));t.i18n=a.default;const n=s(r(867)),o=s(r(438));a.default.init({lng:"en_US",fallbackLng:"en_US",resources:{zh_CN:{translation:n.default},en_US:{translation:o.default}}});const i=a.default.t;t.getMessage=i},279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async(t,r)=>{try{let s=!0;return e.body&&!function(e,t){if(e){for(const r in t){if(null==e[r]||""===e[r])return!1;const s=t[r];if(s===String)try{e[r]=String(e[r]);continue}catch(e){throw Error(r+" Param Need String")}if(s===Number)try{if(e[r]=Number(e[r]),isNaN(e[r]))return!1;continue}catch(e){throw Error(r+" Param Need Number")}if(s===Array)try{if(!(e[r]instanceof Array)){const t=JSON.parse(e[r]);if(!(t instanceof Array))return!1;e[r]=t}}catch(e){throw Error(r+" Param Need Array")}if(s===Date)try{const t=new Date(e[r]).toString();if("Error Date"==t||null==t)return!1;e[r]=new Date(e[r]);continue}catch(e){throw Error(r+" Param Need Data")}if(s===Object&&!e[r])return!1}return!0}return!1}(t.request.body,e.body)&&(s=!1),s?await r():function(e){e.status=400,e.body="Request parameters error"}(t)}catch(e){t.status=500,t.body=`${e.message}`}}}},33:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(781),n=s(r(399));t.default=async function(e,t){e.url.startsWith("/api/")&&n.default.addApiReq();try{await t()}catch(t){e.body=t}if(e.cookies.set("ApplicationPowerBy","SkyWorldStudio"),e.cookies.set("Application","MinecraftServerStart3"),e.body instanceof Error)return e.status=500,void(e.body=JSON.stringify({status:500,data:e.body.message,time:(new Date).getTime()}));if(!(e.body instanceof a.Stream)){if(404==e.status)return e.status=404,void(e.body=JSON.stringify({status:e.status,data:"404 Not Found",time:(new Date).getTime()}));if("Request parameters error"!=e.body){if("string"==typeof e.body)return e.status=200,void(e.body=JSON.stringify({status:200,data:e.body,time:(new Date).getTime()}));if(405!=e.status)return null===e.body||!1===e.body||void 0===e.body?(e.status=500,void(e.body=JSON.stringify({status:500,data:e.body||null,time:(new Date).getTime()}))):void(200!=e.status||(e.body=JSON.stringify({status:e.status,data:e.body,time:(new Date).getTime()})));e.body=JSON.stringify({status:e.status,data:"405 Method Not Allowed",time:(new Date).getTime()})}else e.body=JSON.stringify({status:400,data:e.body,time:(new Date).getTime()})}}},648:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.language="en_US",this.port=2332,this.address="127.0.0.1"}}},783:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.uuid="",this.registerTime="",this.username="",this.password=""}}},868:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(640)),n=s(r(325)),o=s(r(546)),i=new a.default({prefix:"/api"});i.use(n.default.routes()).use(n.default.allowedMethods()),i.use(o.default.routes()).use(o.default.allowedMethods()),t.default=i},546:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(640)),n=r(95),o=r(95),i=r(326),u=s(r(279)),l=s(r(54)),d=new a.default({prefix:"/panel"});d.post("/init",(0,u.default)({body:{lang:String}}),(async e=>{if(0===l.default.getUserCount()){const t=e.request.body.lang;if(null==n.i18n.getDataByLanguage(t))throw new Error((0,o.getMessage)("router.panel.langNameError"));return n.i18n.changeLanguage(t),i.userConfig.language=t,(0,i.save)(),e.body=!0}throw new Error((0,o.getMessage)("app.initd"))})),t.default=d},325:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(640)),n=s(r(873)),o=r(95),i=s(r(279)),u=s(r(54)),l=new a.default({prefix:"/user"});l.post("/init",(0,i.default)({body:{username:String,password:String}}),(async e=>{if(0===u.default.getUserCount()){const t=e.request.body.username,r=e.request.body.password;if(!u.default.passwordCheck(r))throw new Error((0,o.getMessage)("router.user.passwordCheck"));return n.default.info((0,o.getMessage)("app.panelInit",{userName:t})),u.default.create({username:t,password:r}),e.body=!0}throw new Error((0,o.getMessage)("app.initd"))})),t.default=l},399:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=new class{constructor(){this.apiReqCount=0}addApiReq(){this.apiReqCount++}}},54:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(490)),n=r(828),o=s(r(783)),i=s(r(68));t.default=new class{constructor(){this.users=new Map,i.default.gets("Users",o.default).forEach((e=>{this.users.set(e.uuid,e)}))}getUserCount(){return this.users.size}passwordCheck(e){return/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,15}$/.test(e)}create(e){const t=(0,n.v4)().replace("-",""),r=new o.default;r.uuid=t,r.registerTime=(new Date).toLocaleString(),this.users.set(t,r),this.edit(t,e)}edit(e,t){const r=this.users.get(e);t.username&&(r.username=t.username),t.password&&(r.password=(0,a.default)(t.password)),i.default.set("Users",e,r)}}},326:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userConfig=t.save=t.initUserConfig=void 0;const a=s(r(68)),n=s(r(648)),o=r(95);let i=null;t.userConfig=i,t.initUserConfig=function(){t.userConfig=i=a.default.get("Configs",n.default,"default"),i||(t.userConfig=i=new n.default,a.default.create("Configs","default",i)),i.language&&o.i18n.changeLanguage(i.language)},t.save=function(){a.default.set("Configs","default",i)}},640:e=>{e.exports=require("@koa/router")},805:e=>{e.exports=require("i18next")},406:e=>{e.exports=require("koa")},4:e=>{e.exports=require("koa-body")},511:e=>{e.exports=require("koa-session")},97:e=>{e.exports=require("koa-static")},94:e=>{e.exports=require("log4js")},490:e=>{e.exports=require("md5")},828:e=>{e.exports=require("uuid")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")},781:e=>{e.exports=require("stream")},438:e=>{e.exports=JSON.parse('{"app":{"initLang":"Internationalization system initialization completed, Language: English","initLogger":"Log system initialization completed","initOver":"Initialization complete","Started":"MSS 3 Panel Service started!","StartedTip":"If you want to exit MSS 3, you can use ctrl+c to terminate the program","StartedHost":"The panel is already in http://localhost:{{port}} starts listening","Win32WebError":"Unable to automatically invoke Windows browser, please try to open the panel manually","panelInit":"The panel is initializing! Create user: {{userName}}","initd":"The panel has been initialized!"},"router":{"user":{"passwordCheck":"Illegal password!"},"panel":{"langNameError":"Language does not exist!"}}}')},867:e=>{e.exports=JSON.parse('{"app":{"initLang":"国际化系统初始化完成, 语言: 简体中文","initLogger":"日志系统初始化完成","initOver":"初始化完成","Started":"MSS 3 面板服务已启动!","StartedTip":"如果想退出 MSS 3 可以使用 ctrl + c 终止程序","StartedHost":"面板已经在 http://localhost:{{port}} 开始监听","Win32WebError":"无法自动唤起 Windows 浏览器,请尝试手动打开面板","panelInit":"面板正在初始化! 创建用户: {{userName}}","initd":"面板已经初始化过了!"},"router":{"user":{"passwordCheck":"密码不合法!"},"panel":{"langNameError":"语言不存在!"}}}')}},t={};!function r(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}(165)})();