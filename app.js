(()=>{"use strict";var e={165:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(147)),a=s(187);console.log("        _   _         _           _              _          \n       /\\_\\/\\_\\ _    / /\\        / /\\          /\\ \\         \n      / / / / //\\_\\ / /  \\      / /  \\        /  \\ \\        \n     /\\ \\/ \\ \\/ / // / /\\ \\__  / / /\\ \\__    / /\\ \\ \\       \n    /  \\____\\__/ // / /\\ \\___\\/ / /\\ \\___\\  / / /\\ \\ \\      \n   / /\\/________/ \\ \\ \\ \\/___/\\ \\ \\ \\/___/  \\/_//_\\ \\ \\     \n  / / /\\/_// / /   \\ \\ \\       \\ \\ \\          __\\___ \\ \\    \n / / /    / / /_    \\ \\ \\  _    \\ \\ \\        / /\\   \\ \\ \\   \n/ / /    / / //_/\\__/ / / /_/\\__/ / /       / /_/____\\ \\ \\  \n\\/_/    / / / \\ \\/___/ /  \\ \\/___/ /       /__________\\ \\ \\ \n        \\/_/   \\_____\\/    \\_____\\/        _____________\\/ \n"),console.log("[MSS 3] Powered By SkyWorldStudio"),console.log(`[MSS 3] Version: ${(0,a.getInfo)("version")}`),console.log("[MSS 3] Init Starting");const o="public";n.default.existsSync(o)||(console.log('[MSS 3] Warning! This is the developer version! For users, please refer to wiki. For developers, you can create a "public" folder in the root directory'),process.exit(0));const i=s(326);console.log("[MSS 3] Loading program settings"),(0,i.initUserConfig)();const u=s(95);console.log("[MSS 3] "+(0,u.getMessage)("app.initLang"));const l=r(s(873));l.default.log((0,u.getMessage)("app.initLogger")),l.default.log((0,u.getMessage)("app.initOver"));const d=r(s(37)),f=r(s(406)),c=r(s(4)),g=r(s(511)),_=r(s(97)),p=r(s(685)),h=s(828),y=r(s(868)),m=r(s(33)),S=new f.default;S.keys=[(0,h.v4)()],S.use((0,g.default)({key:(0,h.v4)(),maxAge:864e5,overwrite:!0,httpOnly:!0,signed:!0,rolling:!1,renew:!1,secure:!1},S)),S.use((0,c.default)({multipart:!0,parsedMethods:["POST","PUT","DELETE","GET"]})),S.use((0,_.default)(o)),S.use((async(e,t)=>{l.default.info(`[Req] Method: ${e.method} URL: ${e.URL.href}`),l.default.info(`[Req] IP: ${e.ip} User: ${e.session.userName} UUID: ${e.session.uuid}`),await t()})),S.use(m.default),S.use(y.default.routes()).use(y.default.allowedMethods());const w=p.default.createServer(S.callback()),b=i.userConfig.port,M=i.userConfig.address;if(w.listen(b,M),l.default.info("=----------------------------------------="),l.default.info((0,u.getMessage)("app.Started")),l.default.info((0,u.getMessage)("app.StartedTip")),l.default.info((0,u.getMessage)("app.StartedHost",{port:b})),l.default.info("=----------------------------------------="),"win32"==d.default.platform())try{open(`http://localhost:${b}/`)}catch(e){l.default.warn((0,u.getMessage)("app.Win32WebError"))}},68:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(147)),a=r(s(17));t.default=new class{constructor(){this.CONFIG_PATH=a.default.join(process.cwd(),"data"),n.default.existsSync(this.CONFIG_PATH)||n.default.mkdirSync(this.CONFIG_PATH)}create(e,t,s){const r=a.default.join(this.CONFIG_PATH,e);if(n.default.existsSync(r)||n.default.mkdirSync(r),!this.checkFileName(t))throw new Error("Illegal profile name!");const o=JSON.stringify(s),i=a.default.join(r,t+".json");n.default.writeFileSync(i,o,{encoding:"utf-8"})}get(e,t,s){const r=a.default.join(this.CONFIG_PATH,e);if(n.default.existsSync(r)||n.default.mkdirSync(r),!this.checkFileName(s))throw new Error("Illegal profile name!");const o=a.default.join(r,s+".json");if(!n.default.existsSync(o))return null;const i=n.default.readFileSync(o,{encoding:"utf-8"}),u=JSON.parse(i);return this.JSONToClass(new t,u)}gets(e,t){const s=a.default.join(this.CONFIG_PATH,e);n.default.existsSync(s)||n.default.mkdirSync(s);const r=n.default.readdirSync(s),o=new Array;return r.forEach((e=>{if(e.endsWith(".json")){const r=n.default.readFileSync(a.default.join(s,e),{encoding:"utf-8"}),i=JSON.parse(r);o.push(this.JSONToClass(t,i))}})),o}set(e,t,s){const r=a.default.join(this.CONFIG_PATH,e);if(n.default.existsSync(r)||n.default.mkdirSync(r),!this.checkFileName(t))throw new Error("Illegal profile name!");n.default.writeFileSync(a.default.join(r,t+".json"),JSON.stringify(s),{encoding:"utf-8"})}JSONToClass(e,t){for(const s of Object.keys(e)){const r=t[s];void 0!==r&&(r instanceof Array?e[s]=r:r instanceof Object&&"object"==typeof r?this.JSONToClass(e[s],r):e[s]=r)}return e}checkFileName(e){const t=["\\","/",".."];for(const s of t)if(e.includes(s))return!1;return!0}}},873:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(94));n.default.configure({appenders:{console:{type:"stdout",layout:{type:"pattern",pattern:"[%d{MM/dd hh:mm:ss}] [%[%p%]] %m"}},logFile:{type:"file",filename:"logs/last.log",layout:{type:"pattern",pattern:"%d %p %m"}}},categories:{default:{appenders:["console","logFile"],level:"info"}}});const a=n.default.getLogger("default");t.default=a},187:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getInfo=void 0;const n=r(s(147)),a="package.json";t.getInfo=function(e){if(n.default.existsSync(a)){const t=JSON.parse(n.default.readFileSync(a,{encoding:"utf-8"}));if(t[e])return t[e]}}},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s{static set(e,t){s.data.set(e,t)}static get(e,t){return s.data.has(e)?s.data.get(e):t}static remove(e){return s.data.delete(e)}}t.default=s,s.data=new Map},95:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=t.getMessage=void 0;const n=r(s(805));t.i18n=n.default;const a=r(s(867)),o=r(s(438)),i=r(s(147)),u=r(s(17)),l=r(s(68));n.default.init({lng:"en_US",fallbackLng:["en_US"],resources:{zh_CN:{translation:a.default},en_US:{translation:o.default}}});const d=u.default.join(l.default.CONFIG_PATH,"langs");i.default.existsSync(d)||i.default.mkdirSync(d);const f=i.default.readdirSync(d);let c="[MSS 3] Loaded Lang File: en_US, zh_CN";f.forEach((e=>{if(e.endsWith(".json")){const t=e.replace(".json",""),s=i.default.readFileSync(u.default.join(d,e),{encoding:"utf-8"}),r=JSON.parse(s);n.default.addResourceBundle(t,"translation",r),n.default.reloadResources(),c+=", "+t}}));const g=n.default.t;t.getMessage=g},279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return async(t,s)=>{try{let r=!0;return e.body&&!function(e,t){if(e){for(const s in t){if(null==e[s]||""===e[s])return!1;const r=t[s];if(r===String)try{e[s]=String(e[s]);continue}catch(e){throw Error(s+" Param Need String")}if(r===Number)try{if(e[s]=Number(e[s]),isNaN(e[s]))return!1;continue}catch(e){throw Error(s+" Param Need Number")}if(r===Array)try{if(!(e[s]instanceof Array)){const t=JSON.parse(e[s]);if(!(t instanceof Array))return!1;e[s]=t}}catch(e){throw Error(s+" Param Need Array")}if(r===Date)try{const t=new Date(e[s]).toString();if("Error Date"==t||null==t)return!1;e[s]=new Date(e[s]);continue}catch(e){throw Error(s+" Param Need Data")}if(r===Object&&!e[s])return!1}return!0}return!1}(t.request.body,e.body)&&(r=!1),r?await s():function(e){e.status=400,e.body="Request parameters error"}(t)}catch(e){t.status=500,t.body=`${e.message}`}}}},33:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(781),a=r(s(617));t.default=async function(e,t){e.url.startsWith("/api/")&&a.default.set("ApiReqCount",a.default.get("ApiReqCount",0)+1);try{await t()}catch(t){e.body=t}if(e.cookies.set("ApplicationPowerBy","SkyWorldStudio"),e.cookies.set("Application","MinecraftServerStart3"),e.body instanceof Error)return e.status=500,void(e.body=JSON.stringify({status:500,data:e.body.message,time:(new Date).getTime()}));if(!(e.body instanceof n.Stream)){if(404==e.status)return e.status=404,void(e.body=JSON.stringify({status:e.status,data:"404 Not Found",time:(new Date).getTime()}));if("Request parameters error"!=e.body){if("string"==typeof e.body)return e.status=200,void(e.body=JSON.stringify({status:200,data:e.body,time:(new Date).getTime()}));if(405!=e.status)return null===e.body||!1===e.body||void 0===e.body?(e.status=500,void(e.body=JSON.stringify({status:500,data:e.body||null,time:(new Date).getTime()}))):void(200!=e.status||(e.body=JSON.stringify({status:e.status,data:e.body,time:(new Date).getTime()})));e.body=JSON.stringify({status:e.status,data:"405 Method Not Allowed",time:(new Date).getTime()})}else e.body=JSON.stringify({status:400,data:e.body,time:(new Date).getTime()})}}},648:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.language="en_US",this.port=2332,this.address="127.0.0.1"}}},783:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.permission=1,this.uuid="",this.registerTime="",this.username="",this.password="",this.lastLoginTime=""}}},868:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(640)),a=r(s(325)),o=r(s(546)),i=new n.default({prefix:"/api"});i.use(a.default.routes()).use(a.default.allowedMethods()),i.use(o.default.routes()).use(o.default.allowedMethods()),t.default=i},546:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(640)),a=s(95),o=s(95),i=s(326),u=r(s(279)),l=r(s(54)),d=new n.default({prefix:"/panel"});d.post("/init",(0,u.default)({body:{lang:String}}),(async e=>{if(0===l.default.getUserCount()){const t=e.request.body.lang;if(null==a.i18n.getDataByLanguage(t))throw new Error((0,o.getMessage)("router.panel.langNameError"));return a.i18n.changeLanguage(t),i.userConfig.language=t,(0,i.save)(),e.body=!0}throw new Error((0,o.getMessage)("app.initd"))})),t.default=d},325:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(640)),a=r(s(873)),o=s(95),i=r(s(279)),u=r(s(54)),l=new n.default({prefix:"/user"});l.post("/init",(0,i.default)({body:{username:String,password:String}}),(async e=>{if(0===u.default.getUserCount()){const t=e.request.body.username,s=e.request.body.password;if(!u.default.passwordCheck(s))throw new Error((0,o.getMessage)("router.user.passwordCheck"));return a.default.info((0,o.getMessage)("app.panelInit",{userName:t})),u.default.create({username:t,password:s,permission:10}),u.default.login(e,t,s),e.body=!0}throw new Error((0,o.getMessage)("app.initd"))})),l.post("/login",(0,i.default)({body:{username:String,password:String}}),(async e=>{const t=e.request.body.username,s=e.request.body.password;throw u.default.login(e,t,s)&&u.default.login(e,t,s),new Error((0,o.getMessage)("router.user.loginFailed"))})),t.default=l},54:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(490)),a=s(828),o=r(s(783)),i=r(s(68)),u=r(s(617)),l=r(s(873));t.default=new class{constructor(){this.users=new Map,i.default.gets("Users",new o.default).forEach((e=>{this.users.set(e.uuid,e)})),l.default.log("[UserManager] User Count: "+this.users.size)}getUserCount(){return this.users.size}passwordCheck(e){return/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,15}$/.test(e)}login(e,t,s){u.default.set("LoginCount",u.default.get("LoginCount",0)+1);const r=e.socket.remoteAddress;if(this.userCheck(t,s)){l.default.log(`[Login] IP: ${r} loginUser: ${t} Successful!`);const s=this.getUserFromName(t),n=s.uuid;return s.lastLoginTime=(new Date).toLocaleString(),i.default.set("Users",n,s),e.session.isLogin=!0,e.session.token=this.getToken(),e.session.uuid=n,e.session.save(),!0}{u.default.set("LoginFailedCount",u.default.get("LoginFailedCount",0)+1);const e=u.default.get("LoginFailedIp",new Map);return u.default.set("LoginFailedIp",u.default.get("LoginFailedIp",e.set(r,e.get(r,0)+1))),l.default.log(`[Login] IP: ${r} loginUser: ${t} Failed!`),!1}}getUserFromName(e){let t=null;return this.users.forEach((s=>{s.username==e&&(t=s)})),t}getToken(){return(0,a.v4)().replace(/-/gim,"")+(new Date).getTime()}create(e){const t=(0,a.v4)().replace("-",""),s=new o.default;s.uuid=t,s.registerTime=(new Date).toLocaleString(),this.users.set(t,s),this.edit(t,e)}edit(e,t){const s=this.users.get(e);t.username&&(s.username=t.username),t.password&&(s.password=(0,n.default)(t.password)),t.permission&&(s.permission=t.permission),i.default.set("Users",e,s)}userCheck(e,t){const s=this.getUserFromName(e);return s&&(0,n.default)(t)==s.password}}},326:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userConfig=t.save=t.initUserConfig=void 0;const n=r(s(68)),a=r(s(648)),o=s(95);let i=null;t.userConfig=i,t.initUserConfig=function(){t.userConfig=i=n.default.get("Configs",a.default,"default"),i||(t.userConfig=i=new a.default,n.default.create("Configs","default",i)),i.language&&o.i18n.changeLanguage(i.language)},t.save=function(){n.default.set("Configs","default",i)}},640:e=>{e.exports=require("@koa/router")},805:e=>{e.exports=require("i18next")},406:e=>{e.exports=require("koa")},4:e=>{e.exports=require("koa-body")},511:e=>{e.exports=require("koa-session")},97:e=>{e.exports=require("koa-static")},94:e=>{e.exports=require("log4js")},490:e=>{e.exports=require("md5")},828:e=>{e.exports=require("uuid")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")},781:e=>{e.exports=require("stream")},438:e=>{e.exports=JSON.parse('{"app":{"initLang":"Internationalization system initialization completed, current language: English (United States)","initLogger":"Logging system initialization finished","initOver":"Initialization completed","Started":"MSS3 Panel Service started!","StartedTip":"Press Ctrl + c to stop the panel","StartedHost":"Listening to http://localhost:{{port}}","Win32WebError":"Unable to automatically evoke the Windows browser, please try opening the panel manually","panelInit":"The panel is initializing! Creating user: {{userName}}","initd":"The panel has been initialized!"},"router":{"user":{"passwordCheck":"The password is illegal!","loginFailed":"Invalid username or password!"},"panel":{"langNameError":"Language does not exist!"}}}')},867:e=>{e.exports=JSON.parse('{"app":{"initLang":"国际化系统初始化完成, 语言: 简体中文","initLogger":"日志系统初始化完成","initOver":"初始化完成","Started":"MSS 3 面板服务已启动!","StartedTip":"如果想退出 MSS 3 可以使用 ctrl + c 终止程序","StartedHost":"面板已经在 http://localhost:{{port}} 开始监听","Win32WebError":"无法自动唤起 Windows 浏览器,请尝试手动打开面板","panelInit":"面板正在初始化! 创建用户: {{userName}}","initd":"面板已经初始化过了!"},"router":{"user":{"passwordCheck":"密码不合法!","loginFailed":"用户名或密码错误!"},"panel":{"langNameError":"语言不存在!"}}}')}},t={};!function s(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,s),a.exports}(165)})();